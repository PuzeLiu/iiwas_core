<?xml version="1.0"?>
<launch>
    <arg name="world_iiwa_f_x" default="0.190"/>
    <arg name="world_iiwa_f_y" default="0.813"/>
    <arg name="world_iiwa_f_z" default="0.0"/>
    <arg name="world_iiwa_f_rpy" default="0 0 0"/>
    <arg name="world_iiwa_f_pitch" default="0.0"/>
    <arg name="world_iiwa_f_yaw" default="0.0"/>

    <arg name="world_iiwa_b_x" default="3.198"/>
    <arg name="world_iiwa_b_y" default="0.813"/>
    <arg name="world_iiwa_b_z" default="0.000"/>
    <arg name="world_iiwa_b_roll" default="0.0"/>
    <arg name="world_iiwa_b_pitch" default="0.0"/>
    <arg name="world_iiwa_b_yaw" default="0.0"/>

    <arg name="hardware_interface" default="PositionJointInterface"/>
    <arg name="frame_urdf" default="$(find iiwas_description)/robots/iiwas_frame_urdf.xacro"/>
    <arg name="iiwa_urdf" default="$(find iiwas_description)/robots/iiwa.urdf.xacro"/>

    <arg name="front_controllers" default="joint_trajectory_controller"/>
    <arg name="back_controllers" default="joint_trajectory_controller"/>

    <node name="rviz" pkg="rviz" type="rviz"
          args="-d $(find iiwas_description)/config/iiwas_two_separate.rviz"/>

    <arg name="world_name" default="$(find iiwas_gazebo)/worlds/iiwas_world.world"/>
    <arg name="gui" default="true"/>
    <arg name="paused" default="true"/>
    <!-- Simulation -->
    <include file="$(find gazebo_ros)/launch/empty_world.launch">
        <arg name="world_name" value="$(arg world_name)"/>
        <arg name="gui" value="$(arg gui)" />
        <arg name="paused" value="$(arg paused)"/>
        <arg name="use_sim_time" value="true"/>
        <!--        <arg name="physics" value="bullet" />-->
    </include>

    <rosparam file="$(find iiwas_control)/config/iiwas_control.yaml" command="load"/>

    <group ns="iiwas_frame">
        <param name="robot_description"
               command="$(find xacro)/xacro '$(arg frame_urdf)' namespace:='iiwas_frame'
               world_to_front_base_x:=$(arg world_iiwa_f_x) world_to_front_base_y:=$(arg world_iiwa_f_y) world_to_front_base_z:=$(arg world_iiwa_f_z)
               world_to_back_base_x:=$(arg world_iiwa_b_x) world_to_back_base_y:=$(arg world_iiwa_b_y) world_to_back_base_z:=$(arg world_iiwa_b_z)"/>

        <node pkg="robot_state_publisher" type="robot_state_publisher" name="frame_publisher" output="screen" ns="iiwas_frame">
            <param name="publish_frequency" type="double" value="50.0"/>
        </node>

        <node name="frame_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
              args="-urdf -model iiwas_frame -param robot_description"/>
    </group>

    <group ns="iiwa_front">
        <param name="robot_description"
               command="$(find xacro)/xacro '$(arg iiwa_urdf)'
               parent:='front_base' robot_name:='F' "/>

        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"  output="screen">
            <param name="publish_frequency" type="double" value="50.0"/>
        </node>

        <node name="iiwas_front_controller" pkg="controller_manager" type="spawner" respawn="true"
              output="screen" args="joint_state_controller $(arg front_controllers)"/>

        <node name="iiwa_front_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
              args="-urdf -model iiwa_front -param robot_description -wait iiwas_frame
              -reference_frame iiwas_frame::front_base"/>

        <node name="iiwa_front_joint_trajectory_controller" pkg="rqt_joint_trajectory_controller" type="rqt_joint_trajectory_controller">
        </node>
    </group>

    <group ns="iiwa_back">
        <param name="robot_description"
               command="$(find xacro)/xacro '$(arg iiwa_urdf)'
               parent:='back_base' robot_name:='B' "/>

        <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" output="screen">
            <param name="publish_frequency" type="double" value="50.0"/>
        </node>

        <node name="iiwas_back_controller" pkg="controller_manager" type="spawner" respawn="true"
              output="screen" args="joint_state_controller $(arg back_controllers)"/>

        <node name="iiwa_back_spawner" pkg="gazebo_ros" type="spawn_model" respawn="false" output="screen"
              args="-urdf -model iiwa_back -param robot_description -wait iiwas_frame
              -reference_frame iiwas_frame::back_base"/>

        <node name="iiwa_back_joint_trajectory_controller" pkg="rqt_joint_trajectory_controller" type="rqt_joint_trajectory_controller">
        </node>
    </group>


</launch>
